<!DOCTYPE html>
<!-- Copied to "view.html" by ct.rb -->
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8"/>

    <link href="css/timelapse.css" rel="stylesheet" type="text/css"/>
    <link href="css/videoset_stats.css" rel="stylesheet" type="text/css"/>
    <link href="css/snaplapse.css" rel="stylesheet" type="text/css"/>
    <link href="css/jquery-ui/smoothness/jquery-ui.custom.css" rel="stylesheet" type="text/css"/>
    <link href="css/ui.slider.extras.css" rel="stylesheet" type="text/css"/>
    <link href="css/player.css" rel="stylesheet" type="text/css"/>

    <script src="js/jquery/jquery.min.js" type="text/javascript"></script>
    <script src="js/jquery/jquery-ui.custom.min.js" type="text/javascript"></script>
    <script src="js/jquery/plugins/mouse/jquery.mousewheel.min.js" type="text/javascript"></script>
    <script src="js/jquery/plugins/query/jquery.query-2.1.7.js" type="text/javascript"></script>
    <script src="js/jquery/plugins/carousel/jcarousellite.min.js" type="text/javascript"></script>
    <script src="js/jquery/plugins/mouse/jquery.mousecapture.js" type="text/javascript"></script>
    <script src="js/org/gigapan/util.js" type="text/javascript"></script>
    <script src="js/org/gigapan/timelapse/videoset_stats.js" type="text/javascript"></script>
    <script src="js/org/gigapan/timelapse/videoset.js" type="text/javascript"></script>
    <script src="js/org/gigapan/timelapse/timelapse.js" type="text/javascript"></script>
    <script src="js/Math.uuid.js" type="text/javascript"></script>
    <script src="js/org/gigapan/timelapse/snaplapse.js" type="text/javascript"></script>
    <script src="js/org/gigapan/timelapse/snaplapseViewer.js" type="text/javascript"></script>
    <script src="js/org/gigapan/timelapse/timelapseViewer.js" type="text/javascript"></script>
    <script src="js/org/gigapan/timelapse/mercator.js" type="text/javascript"></script>

    <script type="text/javascript">
      // Needed for IE to load our templates from file:url
      jQuery.support.cors = true;

      var url = "http://g7.gigapan.org/timemachines/sdo-color-crf24-g10-bf0-l/";
      var url2 = "http://g7.gigapan.org/timemachines/sdo-color-crf24-g10-bf0-l/";
      // This one has black frames at the end of each video so that IE 10 on Win 7 won't lockup at the end of playback
      //var url = "http://g7.gigapan.org/pdille/patp10-b/patp10-b.timemachine";

      var lastTime = 0;
      var lView = 0;
      var rView = 1;

      function init() {
        var myView = null;
        var myTime = 0;
	

        var hashVars = org.gigapan.Util.getHashVars();

        if (hashVars) {
          if (hashVars.v) var viewParam = hashVars.v.split(",");
          if (hashVars.t) var timeParam = hashVars.t.split(",");

          if (viewParam) myView = formatView(viewParam);
          if (timeParam) myTime = timeParam[0];
        }

        // Examples:
        //myView = {center: {"x": 43928.36538461538, "y": 39175.881410256414}, "zoom": 2};
        //myView = {center: {"lat": 8.621690, "lng": 0.829690}, "zoom": 3};
        //myView = {bbox: {"ne": {"lat": 11.138970, "lng": 1.806690}, "sw": {"lat" : 6.104410, "lng": -0.147310}}};
        //myView = {bbox: {"xmin": 26459.77564102564, "xmax": 61396.955128205125, "ymin": 29157.131410256414, "ymax": 49194.631410256414}};

        var viewerOptions = {
          url: url, //can be absolute or relative
          initialTime: myTime, //default to 0; in video time
          playerSize: "480p", //label name from size array specified in tm.json. Defaults to the first element
          loopPlayback: false, //defaults to false
          initialView: myView, //see above for possible views to use
          playOnLoad: false, //defaults to false
          playbackSpeed: 1, //[-1,-.5,-.25,.25,.5,1] available, defaults to 1
          layer: lView, //defaults to first layer. All sets have at least 1 layer starting at index 0
          showShareBtn: false, //defaults to true
          showZoomControls: false, //defaults to true
          showMainControls: true //defaults to true
        };

        var viewerOptions2 = {
          url: url2, //can be absolute or relative
          initialTime: myTime, //default to 0; in video time
          playerSize: "480p", //label name from size array specified in tm.json. Defaults to the first element
          loopPlayback: false, //defaults to false
          initialView: myView, //see above for possible views to use
          playOnLoad: false, //defaults to false
          playbackSpeed: 1, //[-1,-.5,-.25,.25,.5,1] available, defaults to 1
          layer: rView, //defaults to first layer. All sets have at least 1 layer starting at index 0
          showShareBtn: false, //defaults to true
          showZoomControls: false, //defaults to true
          showMainControls: false //defaults to true
        };

        timelapse = new org.gigapan.timelapse.Timelapse("player1", viewerOptions);

        timelapse2 = new org.gigapan.timelapse.Timelapse("player2", viewerOptions2);

        window.onhashchange = org.gigapan.Util.onHashChange
      }

      function onTimeMachinePlayerReady(viewerDivId) {
	timelapse.addViewChangeListener(viewSynch);
	timelapse.addTimeChangeListener(timeSynch);
	timelapse.addVideoPlayListener(playSynch);
	timelapse.addVideoPauseListener(pauseSynch);

        shiftView = timelapse.getView();
        shiftView.x -= (0/shiftView.scale);
        timelapse.warpTo(shiftView);

	viewSynch();

	$("#player1 .controls .sidebuttons").hide();
        $("#player2 .carousel").hide();
        $("#player1 .carousel").hide();

	}

      // Share url specific functions

      function formatView(viewParam){
        var view = null;
        if (viewParam.indexOf("latLng") != -1) {
          if (viewParam.length == 4)
            view = {center: {"lat": viewParam[0], "lng": viewParam[1]}, "zoom": viewParam[2]};
          else if (viewParam.length == 5)
            view = {bbox: {"ne": {"lat": viewParam[0], "lng": viewParam[1]}, "sw": {"lat" : viewParam[2], "lng": viewParam[3]}}};
        } else { // Assume points if the user did not specify latLng. Also allow for the omission of 'pts' param for backwards compatibility
          if ((viewParam.indexOf("pts") == -1 && viewParam.length == 3) || viewParam.length == 4)
            view = {center: {"x": viewParam[0], "y": viewParam[1]}, "zoom": viewParam[2]};
          else if ((viewParam.indexOf("pts") == -1 && viewParam.length == 4) || viewParam.length == 5)
            view = {bbox: {"xmin": viewParam[0], "xmax": viewParam[1], "ymin": viewParam[2], "ymax": viewParam[3]}};
        }
        return view;
      }

      // changes current view
      function setView(view) {
        if (view) timelapse.setNewView(formatView(view.split(",")),false);
      }

      // changes current view and time
      function setViewAndTime(view, time) {
        if (view) timelapse.setNewView(formatView(view.split(",")),false);
        if (time) timelapse.seek(time);
      }

      // changes the current time
      function setTime(time) {
        if (time) timelapse.seek(time);
      }

      // End share url specific functions

      function viewSynch() {
      shiftView = timelapse.getView();
      shiftView.x += (0/shiftView.scale);
      timelapse2.warpTo(shiftView);
      }

      function timeSynch(time) {
	if (Math.abs(timelapse.getCurrentTime() - lastTime) > 1) {
		timelapse2.seek(timelapse.getCurrentTime());
		lastTime=timelapse.getCurrentTime();
	}
      
      }

      function playSynch() {
      timelapse2.play();
      timelapse2.seek(timelapse.getCurrentTime());
      }

      function pauseSynch() {
      timelapse2.pause();
      timelapse2.seek(timelapse.getCurrentTime());
      }

      function lLayerchange() {
      lView++;
      if (lView >7) lView=0;
      timelapse.switchLayer(lView);
      }

      function rLayerchange() {
      rView++;
      if (rView > 7) rView=0;
      timelapse2.switchLayer(rView);
      }

      function showValue(newValue) {
      document.getElementById("range").innerHTML=newValue;
      }

      $(init);
    </script>
  </head>
  <body style="background-color:gray">

<div id="lSlide">
<input type="range" min="0" max="50" value="0" step="5" onchange="showValue(this.value)"/>
<span id="range">0</span>      
</div>

<div id="hunk" style="width:520px; margin-left:auto; margin-right:auto; align:center;">

      <div id="player1" style="width:260px;float:left"></div>

      <div id="player2" style="width:260px;float:left"></div>

</div>

      <div id="leftBurton"> <input type="button" value="Click me!" onclick="lLayerchange()"> </div>

      <div id="rightBurton"> <input type="button" value="Click me!" onclick="rLayerchange()"> </div>

<div id="rSlide">
<input type="range" min="0" max="50" value="0" step="5" onchange="showValue(this.value)" />
<span id="range">0</span>
</div>



  </body>


</html>
